# File Preview Helper

`FilePreviewHelper` centralizes logic for rendering previews of files throughout the app. Use the
`preview` function whenever a thumbnail or icon is needed.

```
@Composable
fun FilePreviewHelper.Preview(file: File, modifier: Modifier = Modifier)
```

The helper determines the file `PreviewType` from the extension and provides an appropriate
thumbnail when possible (images, videos, PDFs, APKs) or falls back to an icon. Extend the
`PreviewType` sealed class and update `getPreviewType` to support new file formats.

Preview generation happens off the UI thread using Kotlin coroutines. Heavy work
like parsing archives or decoding album art runs on a background dispatcher and
updates Compose state once finished. While a preview is loading, a fallback icon
is shown.

Plain text files (`.txt`, `.log`, `.csv`, etc.) display the first three lines of
content when readable. Large or binary files automatically fall back to the
default icon.

Archive files (`.zip`, `.rar`, `.7z`) show the archive icon with a summary of the number of items
contained inside, e.g. `ZIP (12 files)`. Entry counts are calculated using `commons-compress` and
capped at 10k entries to avoid UI slowdowns on huge or corrupted archives.

All bitmaps generated by the helper are stored in a size bounded LRU cache. When
memory pressure causes entries to be evicted, bitmaps are scheduled for
recycling after a short delay. This prevents Compose from attempting to draw a
bitmap that has already been recycled.

The cache now listens for `onTrimMemory` callbacks via the `Cleaner` application
class. When the system requests memory, cached bitmaps are either trimmed or
fully cleared to avoid out-of-memory errors.
